# 文字起こし機能 - 要件定義

## 概要

WhisperKitを使用したオンデバイス音声文字起こし機能を実装する。高精度な音声認識、多言語対応、話者分離機能を提供し、完全にローカルで動作するプライバシー重視のソリューションを構築する。

## 機能要件

### FR1: 基本文字起こし機能

#### FR1.1 自動文字起こし
- **要件**: 録音完了後に自動で文字起こしを実行
- **詳細**:
  - 録音停止時に自動でWhisper処理開始
  - ユーザー設定で自動実行のON/OFF切り替え
  - バックグラウンドでの処理実行
  - 処理中の進捗表示とキャンセル機能

#### FR1.2 手動文字起こし
- **要件**: 録音一覧から個別に文字起こし実行
- **詳細**:
  - 録音詳細画面からの実行ボタン
  - 複数録音の一括処理
  - 処理待ちキュー管理
  - 失敗時の再実行機能

#### FR1.3 リアルタイム文字起こし（将来機能）
- **要件**: 録音中のリアルタイム文字表示
- **詳細**:
  - 録音と同時進行の文字起こし
  - 暫定結果の表示と更新
  - 確定結果への変換
  - パフォーマンスとバッテリー考慮

### FR2: Whisperモデル管理

#### FR2.1 モデル選択
- **要件**: 精度・速度・容量のバランスを考慮したモデル選択
- **詳細**:
  - **Tiny (39MB)**: 最速処理、基本精度
  - **Base (74MB)**: バランス型、推奨設定
  - **Small (244MB)**: 高精度、Wi-Fi推奨
  - **Medium (769MB)**: 最高精度、Pro版限定
  - モデル自動ダウンロード・管理

#### FR2.2 動的モデル切り替え
- **要件**: 状況に応じたモデル自動選択
- **詳細**:
  - バッテリー残量による自動切り替え
  - ネットワーク状況（Wi-Fi/cellular）考慮
  - 録音時間による推奨モデル提案
  - ユーザー設定での強制固定オプション

#### FR2.3 モデルキャッシュ管理
- **要件**: 効率的なモデルファイル管理
- **詳細**:
  - 使用頻度によるキャッシュ管理
  - ストレージ不足時の自動削除
  - モデル更新の通知・自動更新
  - 手動でのモデル削除・再ダウンロード

### FR3: 多言語対応

#### FR3.1 言語自動検出
- **要件**: 音声から言語を自動判定
- **詳細**:
  - Whisperの内蔵言語検出機能使用
  - 信頼度スコア表示
  - 手動言語指定オプション
  - 混在言語への対応検討

#### FR3.2 主要言語サポート
- **要件**: 日本語を中心とした多言語対応
- **詳細**:
  - **日本語**: メイン対応、最高精度
  - **英語**: ビジネス・学習用途
  - **中国語（簡体字・繁体字）**: アジア圏対応
  - **韓国語**: 近隣言語対応
  - その他言語の段階的追加

#### FR3.3 言語別設定
- **要件**: 言語ごとの最適化設定
- **詳細**:
  - 言語別のモデル推奨設定
  - 言語固有の後処理ルール
  - 専門用語辞書の言語別対応
  - UI言語との連動設定

### FR4: 文字起こし品質向上

#### FR4.1 ノイズ・音質対応
- **要件**: 様々な音質条件での精度向上
- **詳細**:
  - 背景ノイズ除去前処理
  - 音量正規化処理
  - 音質分析と最適パラメータ選択
  - 低音質録音での品質警告

#### FR4.2 専門用語・固有名詞対応
- **要件**: ドメイン特化語彙の認識精度向上
- **詳細**:
  - ユーザー辞書機能
  - 頻出語彙の学習・蓄積
  - 業界別専門用語辞書（医療・法律・技術）
  - 固有名詞の自動学習機能

#### FR4.3 文字起こし後処理
- **要件**: 結果の可読性向上
- **詳細**:
  - 句読点自動挿入
  - 改行・段落分け自動化
  - 語尾統一（です/である調）
  - 明らかな誤認識の自動修正

### FR5: 話者分離機能（Pro版）

#### FR5.1 自動話者検出
- **要件**: 複数話者の自動識別
- **詳細**:
  - 音声特徴による話者分離
  - 話者数の自動推定（最大8人）
  - 話者切り替わりタイミング検出
  - 信頼度スコア付き結果

#### FR5.2 話者ラベリング
- **要件**: 話者への名前・ラベル付与
- **詳細**:
  - 話者A、話者B等のデフォルトラベル
  - 手動での名前設定・変更
  - 話者ごとの発言時間・回数統計
  - 話者別発言内容の色分け表示

#### FR5.3 話者学習機能
- **要件**: 同一話者の認識精度向上
- **詳細**:
  - 話者音声特徴の学習・蓄積
  - 過去録音からの話者照合
  - 話者プロファイルの作成・管理
  - プライバシー配慮の設定オプション

### FR6: 処理管理・監視

#### FR6.1 処理進捗表示
- **要件**: 文字起こし処理の可視化
- **詳細**:
  - 進捗バーとパーセンテージ表示
  - 処理段階の表示（前処理・認識・後処理）
  - 残り時間の推定表示
  - 処理速度・性能統計

#### FR6.2 バッチ処理
- **要件**: 複数録音の効率的処理
- **詳細**:
  - 複数選択での一括文字起こし
  - 処理キューの管理・優先度設定
  - バックグラウンド処理継続
  - 完了通知・エラー通知

#### FR6.3 処理履歴・統計
- **要件**: 処理状況の記録・分析
- **詳細**:
  - 文字起こし成功率・失敗率
  - 平均処理時間・速度統計
  - モデル別性能比較
  - 言語別認識精度統計

## 非機能要件

### NFR1: パフォーマンス
- **処理速度**: 1分音声を30秒以内で処理（Base モデル）
- **メモリ使用量**: 処理中の追加メモリ < 500MB
- **CPU使用率**: 処理中CPU使用率 < 80%
- **バッテリー**: 1時間分文字起こしでバッテリー消費 < 30%

### NFR2: 精度・品質
- **認識精度**: 日本語標準語で95%以上（Base モデル）
- **言語検出**: 言語自動検出精度 > 90%
- **話者分離**: 2話者分離精度 > 85%（Pro版）
- **処理成功率**: 全体処理成功率 > 98%

### NFR3: 可用性・安定性
- **オフライン動作**: インターネット接続不要
- **クラッシュ率**: 文字起こし処理中クラッシュ率 < 0.1%
- **復旧性**: 処理中断時の自動復旧機能
- **並行処理**: 録音と文字起こしの並行実行

### NFR4: ユーザビリティ
- **操作性**: 3タップ以内で文字起こし開始
- **結果表示**: 文字起こし結果の即座表示
- **編集機能**: 結果の簡単な編集・修正
- **検索性**: 文字起こし結果での高速検索

## 技術制約

### TC1: WhisperKit制約
- **モデルサイズ**: デバイス容量との兼ね合い
- **処理能力**: デバイス性能による制限
- **対応言語**: Whisperサポート言語に限定
- **更新頻度**: WhisperKitアップデートに依存

### TC2: iOS制約
- **メモリ制限**: iOSメモリ制限下での動作
- **バックグラウンド**: iOS制限時間内での処理
- **ファイルサイズ**: 大容量音声ファイル処理制限
- **並行処理**: CPUコア数による並行処理制限

### TC3: ストレージ制約
- **モデル容量**: 複数モデル保存による容量圧迫
- **キャッシュ**: 処理中間ファイルの容量管理
- **結果保存**: 文字起こし結果の効率的保存
- **一時ファイル**: 処理用一時ファイルの管理

## 受け入れ条件

### AC1: 基本機能
- [ ] 録音後の自動文字起こしが動作する
- [ ] 手動での文字起こし実行が可能
- [ ] 複数Whisperモデルの選択・切り替えが可能
- [ ] 処理進捗が適切に表示される
- [ ] 結果の表示・編集が可能

### AC2: 多言語対応
- [ ] 日本語文字起こしが高精度で動作
- [ ] 英語・中国語・韓国語に対応
- [ ] 言語自動検出が動作
- [ ] 言語別設定が反映される

### AC3: 品質・性能
- [ ] Base モデルで95%以上の認識精度
- [ ] 1分音声を30秒以内で処理
- [ ] メモリ使用量が500MB以下
- [ ] バッテリー消費が適切な範囲

### AC4: Pro版機能
- [ ] 話者分離が動作する
- [ ] 話者ラベリングが可能
- [ ] 話者統計が表示される
- [ ] 話者学習機能が動作

### AC5: 運用性
- [ ] エラー時の適切なメッセージ表示
- [ ] 処理キャンセル機能が動作
- [ ] バッチ処理が可能
- [ ] オフライン動作の確認

## 除外事項

### EX1: 高度な音声処理
- リアルタイム音声変換・翻訳
- 音声合成・読み上げ機能
- 高度な音響解析・可視化
- 音声品質の自動改善

### EX2: 外部サービス連携
- 外部音声認識API利用
- クラウドベース処理
- 他社サービスとの直接連携
- 外部辞書サービス利用

### EX3: 高度なAI機能
- 感情分析・感情認識
- 要約・翻訳機能（別機能として実装）
- 意図理解・対話AI
- 高度な自然言語処理

## 参考資料

- [WhisperKit Documentation](https://github.com/argmaxinc/WhisperKit)
- [OpenAI Whisper Paper](https://arxiv.org/pdf/2212.04356.pdf)
- [Apple Speech Framework](https://developer.apple.com/documentation/speech)
- [Core ML Performance Guidelines](https://developer.apple.com/machine-learning/core-ml/)